<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Таролог Мария</title>
  <style>
    body {
      margin: 0;
      font-family: 'Georgia', serif;
      background: linear-gradient(to bottom, #0d0d0d, #1a1a2e);
      color: #f8f8f8;
      text-align: center;
    }

    header {
      padding: 50px 20px;
      background: url('https://i.ibb.co/dKn0sPq/magic-bg.jpg') center/cover no-repeat;
    }

    header h1 {
      font-size: 42px;
      margin-bottom: 10px;
      color: #ffd700;
      text-shadow: 2px 2px 8px #000;
    }

    header p {
      font-size: 20px;
      font-style: italic;
    }

    section {
      padding: 40px 20px;
      max-width: 900px;
      margin: auto;
      text-align: left;
    }

    h2 {
      color: #ffd700;
      margin-bottom: 20px;
      text-align: center;
    }

    .btn {
      display: inline-block;
      padding: 12px 24px;
      background: #ffd700;
      color: #000;
      text-decoration: none;
      font-weight: bold;
      border-radius: 8px;
      transition: 0.3s;
      cursor: pointer;
      border: none;
    }

    .btn:hover {
      background: #e6c200;
    }

    form input,
    form textarea {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: none;
      border-radius: 5px;
      font-family: inherit;
      font-size: 16px;
      box-sizing: border-box;
    }

    form button {
      margin-top: 10px;
    }

    #status,
    #reviewStatus {
      margin-top: 10px;
      font-size: 16px;
      color: #ffd700;
      text-align: center;
    }

    .reviews-list {
      max-width: 700px;
      margin: 20px auto 50px;
      padding: 0;
      list-style: none;
      color: #f0e68c;
    }

    .review-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      padding: 15px 20px;
      margin-bottom: 15px;
      font-style: italic;
      position: relative;
      box-shadow: 0 0 10px #ffd70033;
    }

    .review-item b {
      display: block;
      margin-top: 10px;
      font-weight: bold;
      color: #ffd700;
      text-align: right;
    }
  </style>
</head>

<body>
  <header>
    <h1>Таролог Мария</h1>
    <p>Откройте тайны судьбы и найдите ответы на свои вопросы</p>
  </header>

  <section>
    <h2>Обо мне</h2>
    <p>Я помогаю людям с помощью карт Таро и интуитивного предсказания.
      Моя цель — дать ясность, поддержку и направление.</p>
  </section>

  <section>
    <h2>Оставьте отзыв</h2>
    <form id="reviewForm">
      <input type="text" id="reviewName" placeholder="Ваше имя" required />
      <input type="text" id="reviewContact" placeholder="Ваш телефон или Instagram" required />
      <textarea id="reviewText" rows="4" placeholder="Ваш отзыв" required></textarea>
      <button type="submit" class="btn">Отправить отзыв</button>
    </form>
    <p id="reviewStatus"></p>

    <ul id="reviewsList" class="reviews-list"></ul>
  </section>

  <section>
    <h2>Форма обратной связи</h2>
    <form id="contactForm">
      <input type="text" id="name" placeholder="Ваше имя" required />
      <input type="text" id="email" placeholder="Ваш Instagram или Telegram" required />
      <textarea id="message" rows="4" placeholder="Ваш вопрос или сообщение" required></textarea>
      <button type="submit" class="btn">Отправить</button>
    </form>
    <p id="status"></p>
  </section>

  <footer>
    <p>© 2025 Таролог Мария | Все права защищены</p>
  </footer>

  <script>
    const reviewForm = document.getElementById('reviewForm');
    const reviewStatus = document.getElementById('reviewStatus');
    const reviewsList = document.getElementById('reviewsList');
    const contactForm = document.getElementById('contactForm');
    const contactStatus = document.getElementById('status');

    function loadReviews() {
      const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
      reviewsList.innerHTML = '';
      reviews.forEach(({ name, contact, text }) => {
        const li = document.createElement('li');
        li.classList.add('review-item');
        li.innerHTML = `<p>«${escapeHtml(text)}»</p>
                        <b>— ${escapeHtml(name)} (${escapeHtml(contact)})</b>`;
        reviewsList.appendChild(li);
      });
    }

    function saveReview(name, contact, text) {
      const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
      reviews.push({ name, contact, text });
      localStorage.setItem('reviews', JSON.stringify(reviews));
    }

    function escapeHtml(text) {
      return text.replace(/[&<>"']/g, (m) => ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      })[m]);
    }

    async function sendReviewToServer(name, contact, text) {
      try {
        const res = await fetch("/send-review", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, contact, text }),
        });
        return res.ok;
      } catch (err) {
        console.error("Ошибка при отправке отзыва:", err);
        return false;
      }
    }

    async function sendContactToServer(name, email, message) {
      try {
        const res = await fetch("/send-contact", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, email, message }),
        });
        return res.ok;
      } catch (err) {
        console.error("Ошибка при отправке контакта:", err);
        return false;
      }
    }

    reviewForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = reviewForm.reviewName.value.trim();
      const contact = reviewForm.reviewContact.value.trim();
      const text = reviewForm.reviewText.value.trim();

      if (!name || !contact || !text) {
        reviewStatus.innerText = "Пожалуйста, заполните все поля.";
        return;
      }

      reviewStatus.innerText = "Отправка...";

      const sent = await sendReviewToServer(name, contact, text);

      if (sent) {
        saveReview(name, contact, text);
        loadReviews();
        reviewForm.reset();
        reviewStatus.innerText = "Спасибо за ваш отзыв!";
      } else {
        reviewStatus.innerText = "Ошибка отправки. Попробуйте позже.";
      }
    });

    contactForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = contactForm.name.value.trim();
      const email = contactForm.email.value.trim();
      const message = contactForm.message.value.trim();

      if (!name || !email) {
        contactStatus.innerText = "Пожалуйста, заполните имя и контакт.";
        return;
      }

      contactStatus.innerText = "Отправка...";

      const sent = await sendContactToServer(name, email, message);

      if (sent) {
        contactStatus.innerText = "✅ Сообщение отправлено!";
        contactForm.reset();
      } else {
        contactStatus.innerText = "❌ Ошибка отправки.";
      }
    });

    loadReviews();
  </script>
</body>
</html>
